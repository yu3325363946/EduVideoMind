import{_ as B,d as I,w as X,g as F,m as G,n as J,o as Q,v as Y,p as Z,q as ee,E as te}from"./_plugin-vue_export-helper-DnkLqMvT.js";import{j as w,u as ae,d as D,p as y,o as h,B as j,s as C,v as m,G as N,U as P,r as S,V as L,P as o,l as p,m as t,q as U,y as se,C as oe,k as ne,F as T,D as le,w as ie,M as re,W as ce,x as ue,X as de,Q as pe}from"./index-Q3dqO0M-.js";import{E as me,g as _e}from"./video-B2wRqW2q.js";import{E as ve}from"./index-Du0b-sqy.js";import"./index-CgUo9-lj.js";import"./request-B6ihF906.js";const he=w({name:"ElContainer"}),fe=w({...he,props:{direction:{type:String}},setup(f){const n=f,a=ae(),s=I("container"),l=D(()=>n.direction==="vertical"?!0:n.direction==="horizontal"?!1:a&&a.default?a.default().some(i=>{const b=i.type.name;return b==="ElHeader"||b==="ElFooter"}):!1);return(u,i)=>(h(),y("section",{class:C([m(s).b(),m(s).is("vertical",m(l))])},[j(u.$slots,"default")],2))}});var ge=B(fe,[["__file","container.vue"]]);const ye=w({name:"ElAside"}),we=w({...ye,props:{width:{type:String,default:null}},setup(f){const n=f,a=I("aside"),s=D(()=>n.width?a.cssVarBlock({width:n.width}):{});return(l,u)=>(h(),y("aside",{class:C(m(a).b()),style:N(m(s))},[j(l.$slots,"default")],6))}});var R=B(we,[["__file","aside.vue"]]);const be=w({name:"ElFooter"}),xe=w({...be,props:{height:{type:String,default:null}},setup(f){const n=f,a=I("footer"),s=D(()=>n.height?a.cssVarBlock({height:n.height}):{});return(l,u)=>(h(),y("footer",{class:C(m(a).b()),style:N(m(s))},[j(l.$slots,"default")],6))}});var q=B(xe,[["__file","footer.vue"]]);const ke=w({name:"ElHeader"}),Se=w({...ke,props:{height:{type:String,default:null}},setup(f){const n=f,a=I("header"),s=D(()=>n.height?a.cssVarBlock({height:n.height}):{});return(l,u)=>(h(),y("header",{class:C(m(a).b()),style:N(m(s))},[j(l.$slots,"default")],6))}});var H=B(Se,[["__file","header.vue"]]);const $e=w({name:"ElMain"}),Ee=w({...$e,setup(f){const n=I("main");return(a,s)=>(h(),y("main",{class:C(m(n).b())},[j(a.$slots,"default")],2))}});var K=B(Ee,[["__file","main.vue"]]);const Ce=X(ge,{Aside:R,Footer:q,Header:H,Main:K}),Ve=F(R);F(q);const Le=F(H),Be=F(K),Ie="/assets/default-uscRzRXF.png",z="/assets/head-Br_gmfFU.jpg",De=["src"],je={key:0,style:{"white-space":"pre-wrap","margin-top":"4px"}},Ae={key:0,style:{"margin-top":"6px"}},Fe=["src"],Me={__name:"ChatAi",setup(f){const a=P().query.title||"当前视频",s=S(!1),l=S(!1),u=S(!1),i=S([{avatar:"https://tdesign.gtimg.com/site/chat-avatar.png",name:"小慧",datetime:new Date().toLocaleString(),content:`✨你好，我是你的智能助手小慧，有什么关于《${a}》的问题尽管问我吧～`,role:"assistant",type:"text"}]),b=S(""),x=S(null),$=S(""),A=(c,e)=>{console.log("handleOperation",c,e)},g=(c,e)=>{console.log(c,e)},r=()=>{i.value=[]},E=c=>{var k;if(u.value)return;const e=(k=c.clipboardData)==null?void 0:k.items;if(e)for(let d=0;d<e.length;d++){const _=e[d];if(_.type.indexOf("image")!==-1){const V=_.getAsFile();if(V){x.value=V,$.value=URL.createObjectURL(V),c.preventDefault();break}}}},M=async()=>{var e,k;if(u.value)return;const c=b.value.trim();if(!(!c&&!x.value)){x.value?i.value.unshift({avatar:z,datetime:new Date().toLocaleString(),content:c,imageUrl:$.value,role:"user",type:"image"}):i.value.unshift({avatar:z,datetime:new Date().toLocaleString(),content:c,role:"user",type:"text"}),i.value.unshift({avatar:"https://tdesign.gtimg.com/site/chat-avatar.png",name:"小慧",datetime:new Date().toLocaleString(),content:"",role:"assistant",type:"text"}),l.value=!0,u.value=!0;try{let d="";if(x.value){const _=new FormData;_.append("image",x.value),_.append("question",c),d=((e=(await(await fetch("http://localhost:8080/api/ai-assistant/image",{method:"POST",body:_})).json()).data)==null?void 0:e.answer)||""}else d=((k=(await(await fetch("http://localhost:8080/api/ai-assistant/text",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:c})})).json()).data)==null?void 0:k.answer)||"";i.value[0].content=d||"AI 没有返回答案",i.value[0].role=d?"assistant":"error"}catch{i.value[0].content="请求失败，请稍后重试",i.value[0].role="error"}finally{l.value=!1,u.value=!1,b.value="",x.value=null,$.value=""}}};return(c,e)=>{const k=L("t-space"),d=L("t-chat-action"),_=L("t-chat-input"),V=me,O=L("t-chat"),W=L("t-dialog");return h(),y(T,null,[o(k,{align:"center"},{default:p(()=>[t("div",{onClick:e[0]||(e[0]=v=>s.value=!0)},e[4]||(e[4]=[t("img",{src:"https://tdesign.gtimg.com/site/chat-avatar.png",class:"avatar"},null,-1)]))]),_:1}),o(W,{visible:s.value,"onUpdate:visible":e[3]||(e[3]=v=>s.value=v),footer:!1,header:"AI助手",mode:"modeless",draggable:"","on-confirm":()=>s.value=!1},{body:p(()=>[o(O,{layout:"both",class:"chat-box",data:i.value,"clear-history":i.value.length>0&&!u.value,"text-loading":l.value,"is-stream-load":u.value,onOnAction:g,onClear:r},{actions:p(({item:v})=>[v.type==="text"?(h(),ne(d,{key:0,content:v.content,"operation-btn":["good","bad","replay","copy"],onOperation:A},null,8,["content"])):v.type==="image"?(h(),y(T,{key:1},[t("img",{src:v.imageUrl,alt:"用户粘贴的图片"},null,8,De),v.content?(h(),y("div",je,le(v.content),1)):U("",!0)],64)):U("",!0)]),footer:p(()=>[o(_,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=v=>b.value=v),class:"custom-chat-input","stop-disabled":u.value,onSend:M,onStop:c.onStop,onPaste:se(E,["prevent"]),placeholder:"请输入文字或粘贴图片",style:{"min-height":"80px"}},null,8,["modelValue","stop-disabled","onStop"]),$.value?(h(),y("div",Ae,[e[6]||(e[6]=t("span",null,"已粘贴图片：",-1)),t("img",{src:$.value,alt:"预览图",style:{"max-width":"120px","border-radius":"6px","vertical-align":"middle"}},null,8,Fe),o(V,{size:"mini",type:"text",onClick:e[2]||(e[2]=()=>{x.value=null,$.value=""})},{default:p(()=>e[5]||(e[5]=[oe("删除")])),_:1,__:[5]})])):U("",!0)]),_:1},8,["data","clear-history","text-loading","is-stream-load"])]),_:1},8,["visible","on-confirm"])],64)}}},Ue={class:"common-layout"},Ne={class:"top-icon"},Oe={href:"#"},Te={class:"bottom-icons"},ze={class:"search-wrapper"},Pe={class:"search-container"},Re={class:"right-section"},qe={class:"theme-toggle"},He={__name:"LayoutShelves",setup(f){const n=P(),a=ce(),s=S(!0),l=S(""),u=D(()=>/^\/core\/video-details\/\w+/.test(n.path)),i=g=>n.path.startsWith(g),b=()=>{if(!u.value){te.warning("当前没有加载视频，无法跳转播放页面");return}a.push(n.path)},x=()=>{a.push("/home/home-page")};ie(s,g=>{g?(document.documentElement.classList.add("dark-theme"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark-theme"),localStorage.setItem("theme","light"))});const $=g=>{s.value=!s.value};re(()=>{localStorage.getItem("theme")==="dark"&&(s.value=!0,document.documentElement.classList.add("dark-theme"))});const A=async()=>{l.value||alert("请输入正确的BV号");const g=ve.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});try{const E=(await _e(l.value)).id;l.value="",a.push(`/core/video-details/${E}`)}catch{console.log("获取视频失败，请检查BV号是否正确");return}finally{g.close()}};return(g,r)=>{const E=J,M=Ve,c=Le,e=L("router-view"),k=Be,d=Ce;return h(),y("div",Ue,[o(d,null,{default:p(()=>[o(M,{class:"aside"},{default:p(()=>[t("div",Ne,[t("a",Oe,[o(Me)])]),t("div",Te,[t("div",{class:"home",onClick:x},[t("div",{class:C(["nav-item",{active:i("/home")}])},[o(E,{size:"20"},{default:p(()=>[o(m(Q))]),_:1}),r[2]||(r[2]=t("span",{class:"nav-text"},"首页",-1))],2)]),t("div",{class:"upload",onClick:b},[t("div",{class:C(["nav-item",{active:i("/core/video-details")}])},[o(E,{size:"20"},{default:p(()=>[o(m(Y))]),_:1}),r[3]||(r[3]=t("span",{class:"nav-text"},"播放",-1))],2)])])]),_:1}),o(d,{class:"content-container"},{default:p(()=>[o(c,{class:"header"},{default:p(()=>[o(E,{size:"36"},{default:p(()=>[o(m(Z))]),_:1}),r[5]||(r[5]=t("span",{class:"cloudy"},"智课云",-1)),t("div",ze,[t("div",Pe,[ue(t("input",{class:"search","onUpdate:modelValue":r[0]||(r[0]=_=>l.value=_),onKeyup:de(A,["enter"]),placeholder:"请输入BV号",type:"text"},null,544),[[pe,l.value]]),o(E,{class:"search-icon",onClick:A},{default:p(()=>[o(m(ee))]),_:1})])]),t("div",Re,[t("div",qe,[t("i",{class:C(["bx",s.value?"bx-sun":"bx-moon"]),onClick:r[1]||(r[1]=_=>$())},null,2)]),r[4]||(r[4]=t("img",{src:Ie,alt:"user"},null,-1))])]),_:1,__:[5]}),o(k,{class:"main"},{default:p(()=>[o(e)]),_:1})]),_:1})]),_:1})])}}},Ye=G(He,[["__scopeId","data-v-f4a33d35"]]);export{Ye as default};
