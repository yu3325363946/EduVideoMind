import{m as M,n as O,E as A,aa as z}from"./_plugin-vue_export-helper-DnkLqMvT.js";import{r as p,w as F,d as b,p as r,P as E,m as t,l as P,D as a,s as x,q as V,F as k,a9 as B,C as h,W,o as c,v as U,x as $,am as G}from"./index-Q3dqO0M-.js";import{i as w}from"./request-B6ihF906.js";const H=v=>w.post("/api/practice/generate",null,{params:{videoId:v}}),J=v=>w.get("/api/practice/list",{params:{videoId:v}}),K=v=>w.post("/api/practice/submitAll",v,{headers:{"Content-Type":"application/json"}}),X={style:{display:"flex"}},Y={class:"glass-panel"},Z={key:0,class:"question-area",style:{"margin-bottom":"20px"}},ee=["name","value"],te={key:0,class:"answer-analysis"},se={key:0,style:{color:"#d32f2f"}},ne={key:1},le={class:"btn-container"},oe={class:"left-btns"},ae=["disabled"],ie=["disabled"],ue={class:"item-num-panel"},re={class:"question-nav"},ce=["onClick"],de={__name:"Exercises",props:{videoId:String},setup(v){const i=p([]),C=p(""),f=p(null),g=p([]),y=p(!1),Q=W(),R=()=>{Q.back()},I=v;console.log("组件 props:",I),F(()=>I.videoId,async s=>{if(s){console.log("收到 videoId:",s);try{await H(s);const e=await J(s);i.value=e.questions.map((l,n)=>({id:l.questionId,displayId:n+1,text:l.question,options:[l.optionA,l.optionB,l.optionC]})),C.value=e.videoTitle}catch(e){console.error("题目加载失败:",e)}}else console.warn("videoId 为空")},{immediate:!0});const m=p({}),d=p(0),o=b(()=>i.value[d.value]),T=s=>{const e=g.value.find(l=>{var n;return l.questionId===s||l.question.includes((n=i.value.find(u=>u.id===s))==null?void 0:n.text)});return e&&!e.correct},D=async()=>{if(!N.value){A.warning("请完成所有题目后再提交");return}try{const s=Object.entries(m.value).map(([n,u])=>({questionId:n,selectedAnswer:String.fromCharCode(65+u)})),e=await K(s);g.value=e,y.value=!0;const l=g.value.filter(n=>n.correct).length;f.value=Math.round(l/12*100),A.success("提交成功")}catch(s){console.error("提交失败:",s),console.log("提交失败，请重试")}},_=b(()=>!y.value||!o.value?null:g.value.find(s=>s.questionId===o.value.id||s.question.includes(o.value.text))),N=b(()=>i.value.length>0&&Object.keys(m.value).length===i.value.length),S=()=>{d.value<i.value.length-1&&d.value++},j=()=>{d.value>0&&d.value--},q=s=>{const e=i.value.findIndex(l=>l.id===s);e!==-1&&(d.value=e)};return(s,e)=>{const l=O;return c(),r(k,null,[E(l,{onClick:R,size:"24px",class:"back-button"},{default:P(()=>[E(U(z))]),_:1}),t("div",X,[t("div",Y,[t("p",null,a(C.value)+"课后练习",1),t("h2",{class:x({red:f.value!==null})}," 得分: "+a(f.value!==null?f.value+"分":"--"),3),e[4]||(e[4]=t("hr",null,null,-1)),o.value?(c(),r("div",Z,[t("h3",null,a(o.value.displayId)+". "+a(o.value.text),1),t("ul",null,[(c(!0),r(k,null,B(o.value.options,(n,u)=>(c(),r("li",{class:"options",key:u,style:{"margin-bottom":"10px"}},[t("label",{class:x({selected:m.value[o.value.id]===u})},[$(t("input",{type:"radio",name:"question_"+o.value.id,value:u,"onUpdate:modelValue":e[0]||(e[0]=L=>m.value[o.value.id]=L)},null,8,ee),[[G,m.value[o.value.id]]]),h(" "+a(String.fromCharCode(65+u))+". "+a(n),1)],2)]))),128))]),y.value&&_.value?(c(),r("div",te,[t("p",null,[e[1]||(e[1]=t("strong",null,"你的答案:",-1)),h(" "+a(_.value.yourAnswer),1)]),_.value.correct?V("",!0):(c(),r("p",se,[e[2]||(e[2]=t("strong",null,"正确答案:",-1)),h(" "+a(_.value.correctAnswer),1)])),t("p",null,[e[3]||(e[3]=t("strong",null,"解析:",-1)),h(" "+a(_.value.explanation),1)])])):V("",!0)])):(c(),r("div",ne," 加载中... ")),t("div",le,[t("div",oe,[t("button",{onClick:j,disabled:d.value===0},"上一题",8,ae),t("button",{onClick:S,disabled:d.value===i.value.length-1},"下一题",8,ie)]),t("div",{class:"right-btns"},[t("button",{onClick:D},"提交")])])]),t("div",ue,[e[5]||(e[5]=t("h3",null,"题号",-1)),t("div",re,[(c(!0),r(k,null,B(i.value,n=>(c(),r("button",{key:n.displayId,class:x({selected:m.value[n.id]!==void 0,wrong:y.value&&T(n.id)}),onClick:u=>q(n.id)},a(n.displayId),11,ce))),128))])])])],64)}}},_e=M(de,[["__scopeId","data-v-08e3fd07"]]);export{_e as default};
